---
title : "Building and Segmenting Lists"
date : "`r Sys.Date()`"
weight : 4
chapter : false
pre : " <b> 7.4 </b> "
---

## Building and Segmenting Your Lists for sending "Weekly Deals" Campaigns

Before you start sending out mass emails to your customers, how do we ensure that your reputation with ESP remains good? The best way to maintain a good email reputation is to ensure your intended recipients actually open their emails. While ESPs do not publicze the algorithm they use to evaluate a sender's reputation, there are Best Common Practices published by [M3AAWG](https://www.m3aawg.org/).

### Relevant Documentations on Email Deliverability
- [Best Common Practices for email senders](https://www.m3aawg.org/sites/default/files/document/M3AAWG_Senders_BCP_Ver3-2015-02.pdf)
- [Best Common Practicesfor email vetting](https://www.m3aawg.org/documents/en/maawg-vetting-best-common-practices-bcp)
- [Best Common Practices for complaint handling](https://www.m3aawg.org/documents/en/m3aawg-recommendations-for-senders-handling-of-complaints)
- [Best Common Practices for Sending Domain reputation](https://www.m3aawg.org/SendingDomsBCP)
In order to evaluate your subscriber's engagement rate, we can modify an existing solution on [SES Event Processing](https://github.com/aws-samples/communication-developer-services-reference-architectures#SES-Event-Processing).

### Solution Description
Like many other IT functions, sending emails requires operational oversight and ongoing management. One such consideration for executing any email delivery is reputation management by means of event processing. SES should be configured to emit events regarding email activity. Many events can be generated by SES, but two that are of high concern are Bounces (the recipient's mail server permanently rejected the email) and Complaints (the email was successfully delivered to the recipient, however recipient marked the email as spam). Failing to respond to these events will damage sending reputation.

The architecture below shows how SES can be configured to emit events to SNS which is then routed SQS and finally to a Lambda for processing. The Lambda function should then evaluate the events and for Bounces and Complaints, update the email address source database and remove the offending addresses from future sends.

Additionally, the Lambda function should be configured to make use of the SES Account Level Suppression List functionality to automatically suppress this email address from future sends.

### Architecture Diagram
<!-- image -->
### Scenario
Instead of only tracking Bounces and Complaints, we can track engagement by saving the last open date/click date events to a customer's database.

**Task**: Modify cloudformation template track engagement by saving last open date and click date to a DynamoDB database. You should set the partition key as the customer's email address and the value as `last_engagement_date`.

#### Step 1: CloudFormation Template
We will use a simplified Cloudformation template to create the resources necessary for this exercise. Download the Cloudformation Template [here](https://static.us-east-1.prod.workshops.aws/public/0e6d1c06-f1f6-4fba-8646-8fc9479a5b46/static/templates/lab_6_4_cfn_template.yaml)!

The following CloudFormation will create an SNS topic, an SQS queue and a placeholder Lambda function. It will also output the ARN value of the SNS topic created as part of the Cloudformation template stack deployment, which we will call `WeeklyDealsCampaignEventsTopicArn`.
{{% notice tip %}}
Note that the Lambda function code is not included in the template, as you will write it yourself in the next steps. The resource will deploy a Python Lambda function. You can alter the resource deployment to a language of your choice.
{{% /notice %}}

#### Step 2: Write the Lambda Function
The Lambda function will process the SES event messages of opens and clicks and updates the last engagement date for each recipient email in a DynamoDB table.
{{% notice tip %}}
You can choose to update the Lambda function in the yaml file and then deploy Cloudformation template or deploy the template with the placeholder first and edit the generated Lambda function thereafter.
{{% /notice %}}

#### Step 3: Deploy the CloudFormation Stack
- Navigate to [AWS CloudFormation console](https://console.aws.amazon.com/cloudformation/), click **Create stack** and select **With new resources (standard)**.
- Choose **Template is ready**, select Upload a template file and upload the file you saved in the previous step. Once uploaded, click Next.
<!-- image -->
Enter a **Stack name** of your choice and click **Next** and **Next** again.
Check the checkbox *I acknowledge that AWS CloudFormation might create IAM resources* then click **Create stack**. The deployment process should take around 3 - 4 minutes.
Wait until your stack has finished deploying, then click on the **Outputs** tab to view the ARN of the SNS topic that was created.
<!-- image -->
{{% notice tip %}}
If you have not configured your Lambda function in the previous step, you can do so by going to the [AWS Lambda console](https://console.aws.amazon.com/lambda/) and change your code accordingly.
{{% /notice %}}

#### Step 4: Configure SES to send email event to the SNS topic
- Since we have created an SNS topic as part of the deployment, the next step would be to configure SES to send "Open" and "Click" events to the **Topic**. Because we are sending emails on behalf of the `Travel Tips` group, configure the `TravelTipsConfigSet` to track email open and click events and send them to the created SNS Topic.
{{% notice tip %}}
Refer to [Lab 4.2](../../4-ManageEnvironment/4.2-event-notification-with-sns/) on how to do so.
{{% /notice %}}

#### Step 5: Test the Solution
To test the solution, send a test email. Check the DynamoDB table to ensure that the last engagement date for the email address has been updated insde the DynamoDB table.
If you're successful, you should see an entry similar to the following in your DynamoDB record.
<!-- image -->

#### Step 6: Follow-up strategies
1. **Determine your sending frequency**: Start by evaluating your current sending frequency. You need to strike a balance between reaching the most number of potentially interested recipients and maintaining a good deliverability/engagement rate.

2. **Segment your list**: Segment your email list based on past engagement activity. Segment your list based on past email opens. For the `WeeklyDeals` campaign, you can adjust the engagement criteria as follows:
- Active subscribers: subscribers who have opened or clicked on your emails in the past 7 days.
- Semi-active subscribers: subscribers who have opened or clicked on your emails in the past 7-21 days.
- Inactive subscribers: subscribers who haven't opened or clicked on your emails in the past 21 days or more.
{{% notice note %}}
Keep in mind that the engagement criteria may vary depending on your industry, target audience, and the type of content you're sending. It's important to regularly evaluate and adjust your engagement criteria to ensure that you're sending relevant and valuable content to your subscribers.
{{% /notice %}}

3. **Frontload pool of good recipients**: Prioritize your active and semi-active subscribers in your email campaigns. These subscribers are more likely to engage with your emails and improve your deliverability rate.

4. **Reconfirm interest of low engagement subscribers**: For subscribers who fall into the inactive category, it's recommended to send a reconfirmation email to make sure they are still interested in receiving your emails. If they don't respond to the reconfirmation email, remove them from your list to avoid damaging your sender reputation.